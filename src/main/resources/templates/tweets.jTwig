  <!DOCTYPE html>
  <html>
    <head>
        <title>JNT Messaging Tweets</title>
        <style>
           header {
            background-color:#262626;
            width:100%;
            height:50px;
            box-shadow: 0px 1px 50px #5E5E5E;
            position:fixed;
            top:0px;
            color: white;
            z-index: 100;
          }

          .new_Tweet {
            text-align: center;
            padding: 1em;
            overflow: hidden;
            background-color: #d1d1e0;
            box-shadow: 0px 1px 50px #5E5E5E;
          }

          .following_tweets {
            text-align: center;
            padding: 1em;
            overflow: hidden;
            background-color: #f0f0f5;
            box-shadow: 0px 1px 50px #5E5E5E;
          }

          .search {
            margin-left: 20px;
          }

          aside {
            float: left;
            padding-left: 2em;
            padding-right: 2em;
            padding-bottom: 2em;
            width: 175px;
          }

		div {
			margin-top: 1em;
		}

		#logoff {
			position: absolute;
			right: 10px;
		}
		
		button {
    		background-color: #d1d1e0;
    		color: black;
    		border: 2px solid #555555;
    		border-radius: 8px;
    		margin-left: 1em;
    		margin-right: 1em;
    		padding: 5px 10px;
		}

		button:hover {
    		background-color: #555555;
    		color: white;
        }

	      a:link {
	      	color: black;
 	   		text-decoration: none;
		}

		a:visited {
			color: black;
    		text-decoration: none;
		}
		
		a:hover {
			color: white;
		}
		

        </style>
      </head>
    <body>
      <header>
          <br>
          <form method = "POST">
            <input type="text" name ="search" class = "search">
            <button type="submit" id="search">Search</button>
            <button id="logoff"><a href = "/logoff">Logoff</a></button>
          </form>
      </header>
          <br>
          <br>
          <br>
        <section class = "new_Tweet">
          <p>What's happening in your world?</p>
          <textarea rows="1 " cols="120" id = "tweetTextArea"></textarea>
          <button type="submit" id="tweet">Tweet</button>
        </section>
          <br>
          <aside id = "popular_tweeters">
            <h3>Popular Tweeters</h3>
          </aside>
      <section class = "following_tweets" id = "following_tweets">  
      </section>
    </body>
    <script>
        	/*Script to build popular tweeters aside */
       {	
        	let xhr = new XMLHttpRequest();
            xhr.open('GET', '/popularTweeters');
            	xhr.onload = function(evt) {
            	if (xhr.status === 200) {
              		var response = JSON.parse(xhr.responseText);
              		for(var i = 0; i < response.length; i++){              		
              			var popularDiv = "popularDiv" + i;
              			var div = document.createElement('div');
              			div.setAttribute('id', popularDiv);
              		
              			var popularBtn = "popularBtn" + i;		
              			var btn = document.createElement('BUTTON');
              			var btnText = document.createTextNode('Follow');
              			btn.appendChild(btnText);
              			btn.setAttribute('tweeter', response[i]);
               			
               			document.getElementById('popular_tweeters').appendChild(div);
               			document.getElementById(popularDiv).appendChild(btn);
               			var tweeter = document.createTextNode(response[i]);
               			document.getElementById(popularDiv).appendChild(tweeter);
               			
               		};
                } else {
                    console.log('Request popular tweeters failed.  Returned status of ' + xhr.status);
                }
            };
            xhr.send();
	    }
        	/* Script to build tweets */
        {	
        	let xhr = new XMLHttpRequest();
            xhr.open('GET', '/tweetList');
            	xhr.onload = function(evt) {
            	if (xhr.status === 200) {
              		var response = JSON.parse(xhr.responseText);
              		for(var i = 0; i < response.length; i++){              		
              			var tweet = "tweet" + i;
              			
              			var div = document.createElement('div');
              			div.setAttribute('id', tweet);
               			div.innerHTML = response[i].tweet;
               			document.getElementById('following_tweets').appendChild(div);
               		};
                } else {
                    console.log('Requesting tweets failed.  Returned status of ' + xhr.status);
                }
            };
            xhr.send();
        }
        
    {
 	  	let tweet_button = document.getElementById('tweet');
 		tweet_button.onclick = function () {
 			var xhr = new XMLHttpRequest();
     		xhr.open('POST', '/submitTweet');
     		xhr.setRequestHeader('Content-Type', 'application/json');
     		xhr.onload = function() {
         		if (xhr.status === 200) {
             		console.log(xhr.responseText);
         		} else if (xhr.status !== 200) {
             		console.log('Request failed.  Returned status of ' + xhr.status);
         		}
     		};
     		var tweet = {tweet: document.getElementById("tweetTextArea").value};

     		xhr.send(JSON.stringify(tweet));
 	    };
	}
   	
   	{
   		let tableClick = document.getElementById('popular_tweeters');
    	tableClick.addEventListener('click', function(evt) {
    		if (evt.target.tagName === 'BUTTON') {
    			let tweeter = evt.target.getAttribute('tweeter');

 				let xhr = new XMLHttpRequest();
     			xhr.open('POST', '/submitFollow');
     			xhr.setRequestHeader('Content-Type', 'application/json');
     			xhr.onload = function() {
         			if (xhr.status === 200) {
             			console.log(xhr.responseText);
         			} else if (xhr.status !== 200) {
             			console.log('Request failed.  Returned status of ' + xhr.status);
         			}
     			};
     			
     			let tweet = {follows: tweeter};
     	
     			xhr.send(JSON.stringify(tweet));
    		}
    	});
    }
   </script>
   </html>
