  <!DOCTYPE html>
  <html>
    <head>
        <title>JNT Messaging Tweets</title>
        <style>
           header {
            background-color:#262626;
            width:100%;
            height:50px;
            box-shadow: 0px 1px 50px #5E5E5E;
            position:fixed;
            top:0px;
            color: white;
            z-index: 100;
          }
          
          input {
          	margin-left: 1em;
		  }
		  
          .new_Tweet {
            text-align: center;
            padding: 1em;
            overflow: hidden;
            background-color: #d1d1e0;
            box-shadow: 0px 1px 50px #5E5E5E;
          }

          .following_tweets {
            text-align: center;
            padding: 1em;
            overflow: hidden;
            background-color: #f0f0f5;
            box-shadow: 0px 1px 50px #5E5E5E;
            height: 60vh;
          }

          .search {
            margin-left: 20px;
          }

          aside {
            float: left;
            padding-left: 2em;
            padding-right: 2em;
            padding-bottom: 2em;
            width: 175px;
          }

		div {
			margin-top: 1em;
		}

		#logoff {
			position: absolute;
			right: 10px;
		}
	  
		table{
  			border-collapse: collapse;
  			width: 100%;
		}
		
		th, td {
 		   height: 40px;
 		   
		}
		
		tr:nth-child(even) {
			background-color: #d1d1e0;
		}

		button {
  			display: inline-block;
  			font-size: 16px;
  			cursor: pointer;
  			text-align: center;
  			text-decoration: none;
  			outline: none;
  			background-color: #53575e;
  			color: #fff;
  			border: none;
  			border-radius: 10px;
  			box-shadow: 0 5px #999;
  			margin-left: 1em;
    		margin-right: 1em;
		}

		button:hover {background-color: #3e8e41}

		button:active {
  			background-color: #3e8e41;
  			box-shadow: 0 5px #666;
  			transform: translateY(4px);
  		}
  		
	    #hrefLogoff:link {
	      	color: white;
 	   		text-decoration: none;
 	   		font-size: 16px;
		}

		#hrefLogoff:visited {
			color: white;
    		text-decoration: none;
    		font-size: 16px;
		}
		
		#hrefLogoff:hover {
			color: white;
		}
		
		.search {
			margin-right: 10em;
		}
		
		#user_info {
			text-align: center;
			margin: 1px;
		}
		

        </style>
      </head>
    <body>
      <header id="header">
          <br>
          <form>
            <input type="text" name ="search" id = "searchText">
            <button type="submit" id="search">Search for User</button>
            <button id="logoff"><a href = "/logoff" id="hrefLogoff">Logoff</a></button>
          </form>
      </header>
          <br>
          <br>
          <br>
        <section class = "new_Tweet">
          <div id="user_info">
          	<p id="phrase">Hello {{username}}.  What's happening in your world?</p>
          </div>
          <textarea rows="1 " cols="120" id = "tweetTextArea"></textarea>
          <button type="submit" id="tweet">Tweet</button>
        </section>
          <br>
          <aside id = "popular_tweeters">
            <h3>Popular Tweeters</h3>
          </aside>
      <section class = "following_tweets">
      <table id = "following_tweets"> 
      </table> 
      </section>
    </body>
    <script>
/*Script to build popular tweeters aside */
       {	
        	let xhr = new XMLHttpRequest();
            xhr.open('GET', '/popularTweeters');
            	xhr.onload = function(evt) {
            	if (xhr.status === 200) {
              		var response = JSON.parse(xhr.responseText);
              		for(var i = 0; i < response.length; i++){              		
              			var popularDiv = "popularDiv" + i;
              			var div = document.createElement('div');
              			div.setAttribute('id', popularDiv);
              		
              			var popularBtn = "popularBtn" + i;		
              			var btn = document.createElement('BUTTON');
              			var btnText = document.createTextNode('Follow');
              			btn.appendChild(btnText);
              			btn.setAttribute('tweeter', response[i]);
               			
               			var hrefValue = "/userActivity?UserName='" + response[i] + "'";
               			console.log(hrefValue); 
               			var createA = document.createElement('a');
        				var createAText = document.createTextNode(response[i]);
        				createA.setAttribute('href', "http://google.com");
        				createA.appendChild(createAText);
        				
               			document.getElementById('popular_tweeters').appendChild(div);
               			document.getElementById(popularDiv).appendChild(btn);
               			document.getElementById(popularDiv).appendChild(createA);
               		};
                } else {
                    console.log('Request popular tweeters failed.  Returned status of ' + xhr.status);
                }
            };
            xhr.send();
	    }
/* Script to build tweets */
        {	
        	let xhr = new XMLHttpRequest();
            xhr.open('GET', '/tweetList');
            	xhr.onload = function(evt) {
            	if (xhr.status === 200) {
              		var response = JSON.parse(xhr.responseText);
                  	var table = document.getElementById("following_tweets");
                  	var row = table.insertRow(0);
                  	row.insertCell(0).innerHTML="<b>Tweet</b>";
                    row.insertCell(1).innerHTML="<b>Author</b>";
                    row.insertCell(2).innerHTML="<b>Post Date</b>";
                    row.insertCell(3);
                    
              		for(var i = 0; i < response.length; i++){            		
              			var tweet = "tweet" + i;
                    	var row = table.insertRow(i + 1);
              			row.insertCell(0).innerHTML=response[i].tweet;
              			
              			var hrefValue = "/userActivity?UserName='" + response[i].createdByName + "'";
               			console.log(hrefValue); 
               			var createA = document.createElement('a');
        				var createAText = document.createTextNode(response[i].createdByName);
        				createA.setAttribute('href', "http://google.com");
        				createA.appendChild(createAText);
              			
              			var unfollowBtn = "unfollowBtn" + i;		
              			var btn = document.createElement('BUTTON');
              			var btnText = document.createTextNode('Unfollow');
              			btn.appendChild(btnText);
              			btn.setAttribute('tweeter', response[i].createdByName);
              			
              			var newCell = row.insertCell(1);
              			newCell.appendChild(createA);
                    	row.insertCell(2).innerHTML=response[i].createTimestamp.substring(0,19)
                    	row.insertCell(3).appendChild(btn);
               		};
                } else {
                    console.log('Requesting tweets failed.  Returned status of ' + xhr.status);
                }
            };
            xhr.send();
        }

/*Script to send tweet to database */        
    {
 	  	let tweet_button = document.getElementById('tweet');
 		tweet_button.onclick = function () {
 			if(document.getElementById('tweetTextArea').value !==''){
 				var xhr = new XMLHttpRequest();
     			xhr.open('POST', '/submitTweet');
     			xhr.setRequestHeader('Content-Type', 'application/json');
     			xhr.onload = function() {
         			if (xhr.status === 200) {
             			console.log(xhr.responseText);
         			} else if (xhr.status !== 200) {
             			console.log('Request failed.  Returned status of ' + xhr.status);
         			}
     			};
     			var tweet = {tweet: document.getElementById("tweetTextArea").value};

     			xhr.send(JSON.stringify(tweet));
     		}
 	    }
	}

/*Script to follow someone*/   	
   	{
   		let tableClick = document.getElementById('popular_tweeters');
    	tableClick.addEventListener('click', function(evt) {
    		if (evt.target.tagName === 'BUTTON') {
    			let tweeter = evt.target.getAttribute('tweeter');

 				let xhr = new XMLHttpRequest();
     			xhr.open('POST', '/submitFollow');
     			xhr.setRequestHeader('Content-Type', 'application/json');
     			xhr.onload = function() {
         			if (xhr.status === 200) {
             			console.log(xhr.responseText);
         			} else if (xhr.status !== 200) {
             			console.log('Request failed.  Returned status of ' + xhr.status);
         			}
     			};
     			
     			let tweet = {follows: tweeter};
     	
     			xhr.send(JSON.stringify(tweet));
    		}
    	});
    }
/*Script to go to search for a  user's page */
   	{
   		let button = document.getElementById('search');
		button.onclick = function () {
   			let user = evt.target.getAttribute('searchText').value;
   			console.log(user);		
   		}
   	}
   	
   	function startTime() {
 		var today = new Date();
    	var h = today.getHours();
    	var m = today.getMinutes();
    	var s = today.getSeconds();
    	m = checkTime(m);
    	s = checkTime(s);
    	var p = document.createElement('p');
    	document.getElementById('p').innerHTML = h + ":" + m + ":" + s;
    	var t = setTimeout(startTime, 500);
	}

	function checkTime(i) {
    	if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
    	return i;
	}
   	
   	
   </script>
   </html>
